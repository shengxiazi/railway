<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<LINK rel="Bookmark" href="/favicon.ico" >
<LINK rel="Shortcut Icon" href="/favicon.ico" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<script type="text/javascript" src="lib/PIE-2.0beta1/PIE_IE678.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.7/iconfont.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin"/>
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
<!--[if IE 6]>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<title>铁路建设工程质量检测信息管理系统</title>
	<style>
		.Hui-article{ top:34px}
		.Hui-aside .menu_dropdown dd ul {
			padding: 3px 0;
		}
		.col-sm-4{
			width:28%;
		}
		.header-log{
			margin-left:10px;
		}
		.panel-primary {
			 border-color:#fff;
		}
		.navbar .logo{height: 44px;line-height: 44px;margin-right: 100px;float: left;}
		.Hui-aside .menu_dropdown li.current a:before{
			border: 12px solid transparent;
			border-left: 12px solid #fff;
			width: 0;
			height: 0;
			right:0;
			top:4px;
			position: absolute;
			content: ' '
		}
	</style>
</head>
<body>
<header class="navbar-wrapper">
	<div class="navbar navbar-fixed-top">
		<div class="header-log">
			<a class="logo navbar-logo f-l mr-10 hidden-xs" href="index.html">铁路建设工程质量检测信息管理系统</a> <a class="logo navbar-logo-m f-l mr-10 visible-xs" href="index.html"></a> <span class="logo navbar-slogan f-l mr-10 hidden-xs"></span> <a aria-hidden="false" class="nav-toggle Hui-iconfont visible-xs" href="javascript:;">&#xe667;</a>
		</div>
		<div class="container-fluid cl">
			<nav id="Hui-nav" class="nav navbar-nav">
				<ul class="cl" id="firstMenu">
					<li><a href="javascript:;" id="first"><i class="Hui-iconfont">&#xe625;</i>系统首页</a> </li>
				</ul>
			</nav>
			<nav id="Hui-userbar" class="nav navbar-nav navbar-userbar hidden-xs">
				<ul class="cl">
					<li></li>
					<li class="dropDown dropDown_hover"> <a href="#" class="dropDown_A"><span class="loginName"></span> <i class="Hui-iconfont">&#xe6d5;</i></a>
						<ul class="dropDown-menu menu radius box-shadow">
							<li><a href="javascript:;" id="personInfo">个人信息</a></li>
							<li><a href="javascript:;" id="pwd">修改密码</a></li>
							<li><a id="logout" href="javascript:;">退出</a></li>
						</ul>
					</li>
					<li id="Hui-skin" class="dropDown right dropDown_hover"> <a href="javascript:;" class="dropDown_A" title="换肤"><i class="Hui-iconfont" style="font-size:18px">&#xe62a;</i></a>
						<ul class="dropDown-menu menu radius box-shadow">
							<li><a href="javascript:;" data-val="default" title="默认（黑色）">默认（黑色）</a></li>
							<li><a href="javascript:;" data-val="blue" title="蓝色">蓝色</a></li>
							<li><a href="javascript:;" data-val="green" title="绿色">绿色</a></li>
							<li><a href="javascript:;" data-val="red" title="红色">红色</a></li>
							<li><a href="javascript:;" data-val="yellow" title="黄色">黄色</a></li>
							<li><a href="javascript:;" data-val="orange" title="绿色">橙色</a></li>
						</ul>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</header>
<aside class="Hui-aside">
	<input runat="server" id="divScrollValue" type="hidden" value="" />
	<div class="menu_dropdown bk_2" id="menuList">

	</div>
</aside>
<div class="dislpayArrow hidden-xs"><a class="pngfix" href="javascript:void(0);" onClick="displaynavbar(this)"></a></div>
<section class="Hui-article-box">
	<div id="Hui-tabNav" class="Hui-tabNav hidden-xs">
		<div class="Hui-tabNav-wp">
			<ul id="min_title_list" class="acrossTab cl">
				<li class="active"><span title="我的桌面" data-href="welcome.html">我的桌面</span><em></em></li>
			</ul>
		</div>
		<div class="Hui-tabNav-more btn-group"><a id="js-tabNav-prev" class="btn radius btn-default size-S" href="javascript:;"><i class="Hui-iconfont">&#xe6d4;</i></a><a id="js-tabNav-next" class="btn radius btn-default size-S" href="javascript:;"><i class="Hui-iconfont">&#xe6d7;</i></a></div>
	</div>
	<div id="iframe_box" class="Hui-article">
		<div class="show_iframe">
			<div style="display:none" class="loading"></div>
			<iframe scrolling="yes" frameborder="0" src="welcome.html"></iframe>
		</div>
	</div>
</section>
<!--修改密码-->
<div id="pwd-modal" style="display:none ;padding:15px;">
	<form class="form form-horizontal" id="password-edit" >
		<div class="row cl">
			<label class="form-label col-xs-2 col-sm-4"><span class="c-red">*</span>当前登录密码：</label>
			<div class="formControls col-xs-8 col-sm-8 skin-minimal">
				<input type="text" class="input-text" id="oldPwd" name="oldPwd"/>
			</div>
		</div>
		<div class="row cl mt-20">
			<label class="form-label col-sm-4"><span class="c-red">*</span>新登录密码：</label>
			<div class="formControls col-xs-8 col-sm-8 skin-minimal">
				<input type="text" class="input-text" name="newPwd" id="newPwd"/>
			</div>
		</div>
		<div class="row cl mt-20">
			<label class="form-label col-sm-4"><span class="c-red">*</span>确认新密码：</label>
			<div class="formControls col-xs-8 col-sm-8 skin-minimal">
				<input type="text" class="input-text" name="rePwd" id="rePwd"/>
			</div>
		</div>
	</form>
</div>
<!--查看个人信息-->
<div class="panel panel-primary" id="proInfo-modal" style="display:none">
	<div class="panel-header">个人信息</div>
	<div class="panel-body">
		<table class="table table-bordered table-border">
			<tr class="text-c">
				<th width="80px">真实姓名:</th>
				<th id="realName" width="170px"></th>
				<th width="80px">性别:</th>
				<th id="sex"></th>
			</tr>
			<tr class="text-c">
				<th>单位类型:</th>
				<th id="comTypeName"></th>
				<th>工作单位:</th>
				<th id="comName"></th>
			</tr>
			<tr class="text-c">
				<th>人员类别:</th>
				<th id="personType"></th>
				<th>从事工作项目:</th>
				<th id="workScope"></th>
			</tr>
			<tr class="text-c">
				<th>手机号码:</th>
				<th id="mobile"></th>
				<th>电话号码:</th>
				<th id="phone"></th>
			</tr>
			<tr class="text-c">
				<th>登录账户:</th>
				<th id="accountName"></th>
				<th>角色名称:</th>
				<th id="roleName"></th>
			</tr>
		</table>
	</div>
</div>
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="lib/layer/2.1/layer.js"></script>
<script type="text/javascript" src="static/h-ui/js/H-ui.js"></script>
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/jquery.validate.min.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/messages_zh.min.js"></script>
<script>
	var menuData;
$(document).ready(function(){
	 //点击菜单栏显示侧边栏
	  $('#firstMenu li', window.parent.document).off('click');
	  $('#firstMenu li', window.parent.document).on('click', function (e) {
	      // 显示侧边栏
	      $('body', window.parent.document).removeClass('big-page');
	      $('.dislpayArrow a', window.parent.document).removeClass('open');
	  });
    //表单验证

	$.ajax({
		url: "/api/v1/initialize/main",    //请求的url地址
		dataType: "json",   //返回格式为json
		async: true, //请求是否异步，默认为异步，这也是ajax重要特性
		type: "GET",   //请求方式
		success: function(reg) {
			if(reg.code==0){
				var f_str='';
				menuData=reg.data.system;
				sessionStorage.comType = reg.data.user.comType;
				$.each(menuData,function(n,val){
					f_str+='<li><a href="javascript:;" data-type="'+val.type+'" data-code="'+val.code+'">'+val.name+'</a> </li>';
				});
				//menus(menuData[0].code);
				$('#firstMenu').append(f_str);
				$("#firstMenu li").eq(0).addClass("current");
				$.Huifold(".menu_dropdown dl dt",".menu_dropdown dl dd","fast",1,"click");
				$('.loginName').text(reg.data.user.accountName);
            }else{
				layer.alert('初始化菜单异常！');
			}
		}
	});
    $('#first').click(function(){
        $('#iframe_box iframe').attr('src','welcome.html');
	});


	//点击展示二级菜单
	$('#firstMenu').on('click','a',function(){
		$(this).parent().addClass('current').siblings().removeClass("current");
		var f_type = $(this).attr('data-code');
		menus(f_type);
		/*左侧菜单*/
		$.Huifold(".menu_dropdown dl dt",".menu_dropdown dl dd","fast",2,"click");
		//默认加载第一个菜单页面
	});

	//菜单函数
	function menus(f_type){
		var s_str='';
		$.each(menuData,function(n,val){
			if(val.code==f_type){
				$.each(val.child,function(n1,val1){
					if(val1.child==undefined ||val1.child==null || val1.child==' '){
						s_str+='<dl>';
						s_str+='<dt></dt><li><a href="javascript:;" data-type="'+val1.type+'" data-id="'+val1.code+'" _href="'+val1.url+'">'+val1.name+'</a></li></dt>';
						s_str+='</dl>';
					}else{
						s_str+='<dl>';
						s_str+='<dt>'+val1.name+'<i class="Hui-iconfont menu_dropdown-arrow">&#xe6d5;</i></dt>';
						s_str+='<dd>';
						s_str+='<ul>';
						$.each(val1.child,function(n2,val2){
							s_str+='<li><a href="javascript:;" data-bdname="'+val2.name+'" data-type="'+val2.type+'" data-id="'+val2.code+'" _href="'+val2.url+'" href="javascript:void(0)">'+val2.name+'</a></li>';
						});
						s_str+='</ul>';
						s_str+='</dd>';
						s_str+='</dl>';
					}

				});
			}
		});
		$('#menuList').html(s_str);
	}

	//点击二级菜单
	$(".Hui-aside").on("click",".menu_dropdown a",function(){
		var childUrl=$(this).attr('_href');
		var tab_name= $(this).text();
		$('#iframe_box iframe').attr('src',childUrl);
		$('#min_title_list').find('li').html('<span>'+tab_name+'</span><em></em>');
		var id = $(this).attr('data-id');
		var type = $(this).attr('data-type');
		var bd_name =$(this).attr('data-bdname');
		//项目id
		sessionStorage.type=type;
		//标段id
		sessionStorage.id=id;
		//标段name
        sessionStorage.bd_name = bd_name;
		lefthropdown(".menu_dropdown  li",id);

	});

	/*菜单处于当前状态*/
	function lefthropdown(obj,id){
		$(obj).each(function(){
			var current = $(this).find("a");
			$(this).removeClass("current");
			if(id == $(current[0]).attr("data-id")){
				$(this).addClass("current");
			}
		});
	}

	//退出登录
	$("#logout").click(function(){
		$.ajax({
			url:'/api/v1/Portal/logout',
			dataType:"json",
			async:true,
			type:'PUT',
			success:function(reg){
				if(reg.code==0){
					sessionStorage.clear();
					window.location.href='/login.html';
				}
			}
		});
	});

	//修改个人密码
	$('#pwd').click(function(){
		var index=layer.open({
			type: 1,
			content: $('#pwd-modal'), //这里content是一个DOM
			area:['500px','300px'],
			btn:['确定','取消'],
			'yes':function(index,layero) {
                if (validform().form()) {
                    var oldPwd = $('#oldPwd').val();
                    var newPwd = $('#newPwd').val();
                    if (oldPwd == null || oldPwd == "" || oldPwd == undefined) {
                        layer.alert('请填写当前登录密码！', {
                            skin: 'layui-layer-molv'
                        });
                        return;
                    }
                    if (newPwd == null || newPwd == "" || newPwd == undefined) {
                        layer.alert('请填写新密码！', {
                            skin: 'layui-layer-molv'
                        });
                        return;
                    }
                    $.ajax({
                        url: '/api/v1/Profile/ChangePassword',    //请求的url地址
                        dataType: "json",
                        data: {'oldPwd': oldPwd, 'newPwd': newPwd},
                        async: true,
                        type: "PUT",
                        success: function (reg) {
                            if (reg.code == 0) {
                                layer.msg(reg.message, {icon: 1, time: 3000}, function () {
                                    top.location.href = "/login.html";
                                    layer.close(index);
                                });
                            } else {
                                layer.alert(reg.message);
                            }
                        },
						error:function(){
                            layer.alert('当前登录密码错误！', {
                                skin: 'layui-layer-molv'
                            });
						}
                    });

                }
            }
		});
	});

	//个人基本信息
	$('#personInfo').click(function(){
		var index=layer.open({
			title:false,
			type: 1,
			content: $('#proInfo-modal'), //这里content是一个DOM
			area:['600px','300px']
		});

		$.ajax({
			url:'/api/v1/Profile',
			dataType: "json",
			async: true,
			type: "GET",
			success: function(reg) {
				if(reg.code==0){
					$.each(reg.data.personBase,function(n1,v1){
						if(v1!=null){
							$('#'+n1).text(v1);
						}
						if(reg.data.account.length!=0){
							$.each(reg.data.account,function(n2,v2){
								$('#'+n2).text(v2);
							});
						}
					});
				}
			}
		});
	});

});

    function validform(){
        return   $("#password-edit").validate({
            debug:true,
            rules: {
                oldPwd: {
                    required: true
                },
                newPwd: {
                    required: true
                },
                rePwd:{
                    required:true,
                    equalTo:"#newPwd"
                }
            }
        });
    }


</script>

</body>
</html>