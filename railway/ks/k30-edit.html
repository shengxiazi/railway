<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <LINK rel="Bookmark" href="/favicon.ico" >
    <LINK rel="Shortcut Icon" href="/favicon.ico" />

    <link rel="stylesheet" type="text/css" href="../static/h-ui/css/H-ui.min.css" />
    <link rel="stylesheet" type="text/css" href="../static/h-ui.admin/css/H-ui.admin.css" />
    <link rel="stylesheet" type="text/css" href="../lib/Hui-iconfont/1.0.7/iconfont.css" />
    <link rel="stylesheet" type="text/css" href="../lib/easyui/easyui.css">
    <link rel="stylesheet" type="text/css" href="../static/h-ui.admin/skin/default/skin.css" id="skin" />
    <link rel="stylesheet" type="text/css" href="../static/h-ui.admin/css/style.css" />
    <link rel="stylesheet" type="text/css" href="../static/h-ui.admin/css/ks-style.css" />
    <!--[if IE 6]>
    <script>DD_belatedPNG.fix('*');</script>
    <![endif]-->
    <!--/meta 作为公共模版分离出去-->
    <title>编辑k30</title>
    <style>
        .col-sm-7{
            width:57%;
        }
    </style>

</head>
<body>
<div class="easyui-layout" data-options="fit:true">
    <div data-options="region:'center',split:true" style="width:100%">
        <article class="page-container">
            <form class="form form-horizontal" id="k30Add">
                <div class="row cl">
                    <div class="col-sm-7">
                        <table class="table" id="firstable" style="border:1px solid #9c9c9c">
                            <tr class="text-c">
                                <td colspan="4" class="border-line">
                                    <h4>委托信息及测点详情</h4>
                                </td>
                            </tr>
                            <tr class="text-l">
                                <th colspan="2"><span class="c-red">*</span>检测编号</th>
                                <th><span class="c-red">*</span>检测方式</th>
                                <th><span class="c-red">*</span>试验日期</th>
                            </tr>
                            <tr class="text-c">
                                <td colspan="2"><input type="text" class="input-text text-c" name="SerialNo" id="SerialNo"/></td>
                                <td>
                                    <select name="TestWay" id="TestWay" style="width:100%;height:100%">
                                        <option value="1">初测</option>
                                        <option value="2">复测</option>
                                        <option value="3">加测</option>
                                    </select>
                                </td>
                                <td><input onfocus="WdatePicker({dateFmt:'yyyy-MM-dd'})" type="text"  class="input-text text-c Wdate" name="StartTime" id="StartTime"/></td>
                            </tr>
                            <tr class="text-l">
                                <th><span class="c-red">*</span>测点里程标识</th>
                                <th><span class="c-red">*</span>测点里程（m）</th>
                                <th width="20%"><span class="c-red">*</span>检测方位</th>
                                <th><span class="c-red">*</span>检测方法</th>
                            </tr>
                            <tr>
                                <td>
                                    <input type="text"  class="input-text text-c" name="PointMileageFlag" disabled/>
                                </td>
                                <td>
                                    <input type="text" class="input-text text-c" name="PointMileage"/>
                                    <input type="hidden" class="input-text text-c" name="PointMileageNum"/>
                                </td>
                                <td>
                                    <input type="text" class="input-text text-c" name="Direction"/>
                                </td>
                                <td>
                                    <select name="TestType" id="TestType" style="width:100%;height:100%">
                                        <option value="3" selected>k30</option>
                                        <option value="4">k40</option>
                                        <option value="6">k60</option>
                                    </select>
                                </td>
                            </tr>
                            <tr class="text-l">
                                <th>记录编号</th>
                                <th colspan="3">采用标准</th>

                            </tr>
                            <tr>
                                <td><input type="text" class="input-text text-c" name="testcode"/></td>
                                <td colspan="3"><input type="text" class="input-text text-c" name="TestStandard" id="TestStandard"/></td>

                            </tr>
                            <tr class="text-c">
                                <td colspan="4" class="border-line"><h4>仪器设备及环境条件</h4></td>
                            </tr>
                            <tr class="text-l">
                                <th><span class="c-red">*</span>检测设备编号</th>
                                <th>荷载板直径(mm)</th>
                                <th><span class="c-red">*</span>温度</th>
                                <th><span class="c-red">*</span>相对湿度（%）</th>
                            </tr>
                            <tr>
                                <td><input type="text" class="input-text text-c" name="MachineId" id="MachineId"/></td>
                                <td><input type="text" class="input-text text-c" name="Diameter" value="300"/></td>
                                <td><input type="text" class="input-text text-c" name="Temperature"/></td>
                                <td><input type="text" class="input-text text-c" name="Humidity"/></td>
                            </tr>
                            <tr>
                                <td colspan="4" class="border-line"><h4>试验结果</h4></td>
                            </tr>
                            <tr class="text-l" style="padding-bottom:10px">
                                <th>沉降1.25mm对应的荷载</th>
                                <th><span class="c-red">*</span>k30设计值(MPa/m)</th>
                                <th><span class="c-red">*</span>k30实测值(MPa/m)</th>
                                <th><span class="c-red">*</span>检测结论</th>
                            </tr>
                            <tr class="text-c">
                                <td><input type="text" class="input-text text-c" name="load" id="load" disabled/></td>
                                <td><input type="text" class="input-text text-c" name="KdjDesign" disabled/></td>
                                <td><input type="text" class="input-text text-c" name="KdjReal" disabled/></td>

                                <td>
                                    <select name="Result" id="Result" style="width:100%;height:100%" disabled>
                                        <option value="1" selected>合格</option>
                                        <option value="2">不合格</option>
                                    </select>
                                </td>
                            </tr>
                        </table>
                        <table class="table" id="secondtable" style="margin-top:10px; border:1px solid #9c9c9c;border-bottom:0">
                            <tr class="text-r">
                                <th width="80px"  style="padding-top:20px">工程名称：</th>
                                <td  style="padding-top:20px" colspan="5">
                                    <input type="text" class="input-none text-l"  name="projectName" value="" disabled/>
                                </td>
                            </tr>
                            <tr class="text-r" >
                                <th >委托单位：</th>
                                <td colspan="3"><input type="text" class="input-none text-l"  name="sgXmComName" value="" disabled/></td>
                                <th><span class="c-red">*</span>检测标高(m)：</th>
                                <td><input type="text" class="input-none text-l" name="TestHeight" id="TestHeight" disabled/></td>
                            </tr>

                            <tr class="text-r">
                                <th>施工里程：</th>
                                <td colspan="3"><input type="text" class="input-none text-l" name="mile" disabled value=""/></td>
                                <input type="hidden" class="input-none text-l" name="mileageFlag" disabled/>
                                <th>压实方式：</th>
                                <td><input type="text" class="input-none text-l" name="compactionMode" disabled/></td>
                            </tr>
                            <tr class="text-r">
                                <th><span class="c-red">*</span>检测部位：</th>
                                <td>
                                    <input type="text" class="input-none text-l" name="Position" disabled/>
                                </td>
                                <th><span class="c-red">*</span>当前层数：</th>
                                <td><input type="text" class="input-none text-l" name="Layers" disabled/></td>
                                <th><span class="c-red">*</span>总层数：</th>
                                <td>
                                    <input type="text" class="input-none text-l" name="TotalLayers" disabled/>
                                </td>
                            </tr>
                            <tr class="text-r">
                                <th style="padding-bottom:15px;width:80px;">填料名称：</th>
                                <td style="padding-bottom:15px; width:150px;"><input type="text" class="input-none text-l" name="FillingStyle" disabled/></td>
                                <th style="width:140px; padding-bottom:15px"><span class="c-red">*</span>填料最大粒径(mm)：</th>
                                <td style="padding-bottom:15px;width:40px">
                                    <input type="text" class="input-none text-l" name="FillingDiameter" disabled/>
                                </td>
                                <th style="padding-bottom:15px;width:120px;"><span class="c-red">*</span>填层厚度(cm)：</th>
                                <td  style="padding-bottom:15px;width:80px">
                                    <input type="text" class="input-none text-l" name="FillingThickness" disabled/>
                                </td>
                            </tr>
                        </table>
                        <table class="table table-border table-bordered ">
                            <thead>
                            <tr class="text-c">
                                <th>仪器设备名称</th>
                                <th>设备编号</th>
                                <th>型号</th>
                                <th>示值范围</th>
                                <th>分辨力</th>
                            </tr>
                            </thead>
                            <tbody id="equipList">
                            <tr>
                                <td><input type="text" class="input-none" name="" disabled/></td>
                                <td><input type="text" class="input-none" name="" disabled/></td>
                                <td><input type="text" class="input-none" name="" disabled/></td>
                                <td><input type="text" class="input-none" name="" disabled/></td>
                                <td><input type="text" class="input-none" name="" disabled/></td>
                            </tr>
                            <tr>
                                <td><input type="text" class="input-none" name="" disabled/></td>
                                <td><input type="text" class="input-none" name="" disabled/></td>
                                <td><input type="text" class="input-none" name="" disabled/></td>
                                <td><input type="text" class="input-none" name="" disabled/></td>
                                <td><input type="text" class="input-none" name="" disabled/></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="col-sm-5">
                        <table id="thirdtable" class="table table-border table-bordered">
                            <tr class="text-c" style="background-color:rgba(238,238,238,0.98)">
                                <th>试验最高层级：</th>
                                <th width="50%"><input type="text" class="input-text text-c" value="5" id="Num" name="Num"/></th>
                            </tr>
                        </table>
                        <table class="table table-border table-bordered" id="fivthtable" style=" background-color:rgba(238,238,238,0.98);">
                            <tbody id="testData">

                            </tbody>
                        </table>
                        <div style="max-width:98%;height:400px" id="test11"  class=" k3picture col-xs-11 col-sm-11 col-md-11">

                        </div>
                    </div>
                </div>
            </form>
        </article>
    </div>
    <div data-options="region:'south'" style="height:40px; padding-top:5px; text-align:center ;background-color:#F8F8F8;border-top:solid #eee 1px" >
        <button class="btn btn-success radius size-S" id="calculate" type="button"><i class="Hui-iconfont">&#xe632;</i>拟合计算</button>
        <button class="btn btn-primary radius size-S" onclick="save_submit()"  type="button" data-toggle="tooltip" title="点我之前，请确保先拟合计算数据了哟！"><i class="Hui-iconfont">&#xe632;</i> 保存</button>
        <button onClick="layer_close();" class="btn btn-default radius size-S" type="button">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
    </div>


</div>
<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="../lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="../lib/easyui/jquery.easyui.min.js"></script>
<script type="text/javascript" src="../lib/layer/2.1/layer.js"></script>
<script type="text/javascript" src="../lib/jquery.validation/1.14.0/jquery.validate.min.js"></script>
<script type="text/javascript" src="../lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="../lib/jquery.validation/1.14.0/messages_zh.min.js"></script>
<script type="text/javascript" src="../static/h-ui/js/H-ui.js"></script>
<script type="text/javascript" src="../static/h-ui.admin/js/H-ui.admin.js"></script>
<script type="text/javascript" src="../lib/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="../static/js/excanvas.min.js"></script>
<script type="text/javascript" src="../static/js/RsCurve.min.js"></script>
<script type="text/javascript">
    var projectId = sessionStorage.pro_id;
    var id = sessionStorage.BasicInfoId;
    var layerNum;
    var SummaryData;
    var submited = false;

    $(function(){
        $('#testDate').val(getNowFormatDate());
        //获取数据
        $.ajax({
            url: '/api/v1/KSData/'+projectId+'/'+id+'/BaseData',    //请求的url地址
            dataType: "json",
            async: false,
            type: "GET",
            success: function(reg) {
                debugger;
                if (reg.code == 0) {
                    $.each(reg.data,function(n,value){
                        $('input[name="'+n+'"]').val(value);
                        if(n=='TestType'|| n=='Result' || n=='TestWay'){
                            $('select[name="'+n+'"]').val(value);
                        }
                        if(n=='StartTime'){
                            $('input[name="'+n+'"]').val(value.substr(0,10));
                        }
                        if(n=='SerialNo'){
                            var serNum = value.substr(0,15);
                            $('#SerialNo').val(serNum);
                            planData(serNum);
                        }
                        if(n=='testStandard'){
                            $('#TestStandard').val(value);
                        }

                        if(n=='KdjReal'){
                            $('#load').val((value*0.00125).toFixed(3));
                        }
                        if(n=='MachineId'){
                            getEquip(value);
                        }
                        if(n=='K3SummaryData'){
                            var str='<tr  class="text-c">';
                            str+='<th rowspan="2">测试级别</th>';
                            str+='<th rowspan="2" colspan="1">荷载强度</br>(MPa)</th>';
                            str+='<th rowspan="2" colspan="1">实际油压<br/>(MPa)</th>';
                            str+='<th colspan="3">下沉量(mm)</th>';
                            str+='<th rowspan="2">荷载板<br>下沉量<br>(0.01mm)</th>';
                            str+='</tr>';
                            str+='<tr  class="text-c">';
                            str+='<th colspan="1">位移1</th>';
                            str+='<th colspan="1">位移2</th>';
                            str+='<th colspan="1">位移平均值</th>';
                            str+='</tr>';
                             SummaryData = reg.data.K3SummaryData;
                            if(SummaryData.length==0){
                                $('#Num').val(SummaryData.length);
                                layerNum = SummaryData.length;
                            }
                            if(SummaryData.length>0){
                                $('#Num').val(SummaryData.length-1);
                                layerNum = SummaryData.length-1;
                                $.each(SummaryData,function(key,val){
                                    str+='<tr class="text-c">';
                                    str+='<td ><input type="text" class="input-none text-c" value="'+val.Grade+'" name="Grade'+key+'" disabled/></td>';
                                    str+='<td ><input type="text" class="input-none text-c" value="'+val.Press.toFixed(3)+'" name="Press'+key+'" disabled/></td>';
                                    str+='<td ><input type="text" class="input-none text-c c-red" value="'+val.OilPress.toFixed(3)+'"  name="OilPress'+key+'" required /></td>';
                                    str+='<td ><input type="text" class="input-none text-c c-red" value="'+(val.S1*100).toFixed(0)+'" name="S1'+key+'" required/></td>';
                                    str+='<td ><input type="text" class="input-none text-c c-red" value="'+(val.S2*100).toFixed(0)+'" name="S2'+key+'" required/></td>';
                                    str+='<td ><input type="text" class="input-none text-c" value="'+(((val.S1+val.S2)/2)*100).toFixed(0)+'" name="SAv'+key+'" disabled/></td>';
                                    str+='<td ><input type="text" class="input-none text-c" value="'+(val.SAverage*100).toFixed(0)+'" name="SAverage'+key+'" disabled/></td>';
                                    str+='</tr>';
                                });

                                //画图
                                var k3Json= reg.data;
                                var data4 = $RS.calcData(k3Json);
                                data4.drawCurve("test11");
                            }else{
                                str+='<td ><input type="text" class="input-none text-c" value="0" name="Grade0" disabled/></td>';
                                str+='<td ><input type="text" class="input-none text-c" value="0" name="Press0" disabled/></td>';
                                str+='<td ><input type="text" class="input-none text-c c-red" value="0"  name="OilPress0" /></td>';
                                str+='<td ><input type="text" class="input-none text-c c-red " value="0" name="S10"/></td>';
                                str+='<td ><input type="text" class="input-none text-c c-red" value="0" name="S20"/></td>';
                                str+='<td ><input type="text" class="input-none text-c" value="0" name="SAv0" disabled/></td>';
                                str+='<td ><input type="text" class="input-none" value="0" name="SAverage0" disabled/></td>';
                                str+='</tr>';
                            }
                            $('#testData').html(str);
                        }
                    });

                }else{
                    layer.msg(reg.message,{icon:6,time:2000});
                }
            }
        });

        //根据委托编号取值
        $('#SerialNo').bind('change',function(){
            var SerialNo = $.trim(this.value);
            $('#SerialNo').val(SerialNo);
            planData(SerialNo);
        });

        //根据设备编号，获取设备信息
        $('#MachineId').bind('change',function(){
            var MachineId = $.trim(this.value);
            getEquip(MachineId);
        });


        $('#Num').bind('change',function(){
           var testNum =  parseInt(this.value);
          if(testNum<layerNum){
               var str='<tr  class="text-c">';
                str+='<th rowspan="2">测试级别</th>';
                str+='<th rowspan="2" colspan="1">荷载强度</br>(MPa)</th>';
                str+='<th rowspan="2" colspan="1">实际油压<br/>(MPa)</th>';
                str+='<th colspan="3">下沉量(0.01mm)</th>';
                str+='<th rowspan="2">荷载板<br>下沉量<br>(0.01mm)</th>';
                str+='</tr>';
                str+='<tr  class="text-c">';
                str+='<th colspan="1">位移1</th>';
                str+='<th colspan="1">位移2</th>';
                str+='<th colspan="1">位移平均值</th>';
                str+='</tr>';
                if(SummaryData.length!=0){
                    $.each(SummaryData,function(key,val){
                        str+='<tr class="text-c">';
                        str+='<td ><input type="text" class="input-none text-c" value="'+val.Grade+'" name="Grade'+key+'" disabled/></td>';
                        str+='<td ><input type="text" class="input-none text-c" value="'+val.Press.toFixed(3)+'" name="Press'+key+'" disabled/></td>';
                        str+='<td ><input type="text" class="input-none text-c" value="'+val.OilPress.toFixed(3)+'"  name="OilPress'+key+'" required/></td>';
                        str+='<td ><input type="text" class="input-none text-c" value="'+(val.S1*100).toFixed(0)+'" name="S1'+key+'" required/></td>';
                        str+='<td ><input type="text" class="input-none text-c" value="'+(val.S1*100).toFixed(0)+'" name="S2'+key+'" required/></td>';
                        str+='<td ><input type="text" class="input-none text-c" value="'+(((val.S1+val.S2)/2)*100).toFixed(0)+'" name="SAv'+key+'" disabled/></td>';
                        str+='<td ><input type="text" class="input-none text-c" value="'+(val.SAverage*100).toFixed(0)+'" name="SAverage'+key+'" disabled/></td>';
                        str+='</tr>';

                        if(key==testNum){
                            return false;
                        }
                    });
                }
                $('#testData').html(str);
                layerNum = testNum;
            }else{
                for(i=1;i<=(testNum-layerNum);i++){
                    str+='<tr class="text-c">';
                    str+='<td ><input type="text" class="input-none text-c" value="'+(layerNum+i)+'" name="Grade'+(layerNum+i)+'" disabled/></td>';
                    str+='<td ><input type="text" class="input-none text-c" value="'+((layerNum+i)*0.04).toFixed(3)+'" name="Press'+(layerNum+i)+'" disabled/></td>';
                    str+='<td ><input type="text" class="input-none text-c" value=""  name="OilPress'+(layerNum+i)+'" /></td>';
                    str+='<td ><input type="text" class="input-none text-c" value="" name="S1'+(layerNum+i)+'"/></td>';
                    str+='<td ><input type="text" class="input-none text-c" value="" name="S2'+(layerNum+i)+'"/></td>';
                    str+='<td ><input type="text" class="input-none text-c" value="" name="SAv'+(layerNum+i)+'" disabled/></td>';
                    str+='<td ><input type="text" class="input-none text-c" value="" name="SAverage'+(layerNum+i)+'" disabled/></td>';
                    str+='</tr>';
                }
                $('#testData').append(str);
                layerNum = testNum;
           }

        });

        $('#calculate').click(function(){
            if(validform().form()) {
                var  data =getData();
                console.log(data);
                //画图
                var data4 = $RS.calcData(data);
                data['KdjReal']=parseFloat( data4.k);
                $('input[name="KdjReal"]').val(data4.k);
                data4.drawCurve("test11");
            }else{
                layer.alert('请先填写必填字段');
            }
        });
    });

    //根据设备编号获取信息
    function getEquip(MachineId){
        $.ajax({
            url:'/api/v1/EquipPackage/'+MachineId+'/ByPackageNo',
            dataType :"json",
            async:false,
            type: "GET",
            success:function(reg){
                if(reg.code==0){
                    var equipData = reg.data.equipList ;
                    var equipStr = "";
                    if(equipData.length!=0){
                        $.each(equipData,function(n,v){
                            equipStr+='<tr class="text-c">';
                            equipStr+='<td>'+v.equipTypeName+'</td>';
                            equipStr+='<td>'+v.equipNo+'</td>';
                            equipStr+='<td>'+v.equipSpec+'</td>';
                            equipStr+='<td>'+v.equipRange+'</td>';
                            equipStr+='<td>'+v.equipResolution+'</td>';
                            equipStr+='<tr>';
                        });
                        $('#equipList').html(equipStr);
                    }
                }
            },
            error:function(){
                layer.alert('获取设备信息失败！');
            }
        });

    }

    //获取委托单信息
    function planData(planCode){
        $.ajax({
            url:'/api/v1/TPlan/'+planCode+'/BySerialNo',
            dataType :"json",
            async:false,
            type: "GET",
            success:function(reg){
                var planData = reg.data;
                if(reg.code==0 && planData.length!=0){
                    $('input[name="PointMileageFlag"]').val(planData.mileageFlag);
                    $('input[name="mile"]').val(planData.mileage);
                    $('input[name="Position"]').val(planData.position);
                    $('input[name="Layers"]').val(planData.layer);
                    $('input[name="TotalLayers"]').val(planData.totalLayer);
                    $('input[name="FillingStyle"]').val(planData.fillingStyle);
                    $('input[name="FillingDiameter"]').val(planData.fillingDiameter);
                    $('input[name="FillingThickness"]').val(planData.fillingThickness);
                    $('input[name="TestHeight"]').val(planData.testHeight);
                    $('input[name="projectName"]').val(sessionStorage.projectName);
                    $('input[name="compactionMode"]').val(planData.compactionMode);
                    $.each(planData.testQuota,function(n,v){
                        if(v.testQuotaCode=='K30'){
                            $('input[name="KdjDesign"]').val(v.design);
                        }
                    });
                }else{
                    layer.msg(reg.message,{icon: 6, time: 2000});
                }
            },
            error:function(){
                layer.msg('获取委托信息请求出错！');
            }
        });

    }

    function getData(){
        var data = new Object();
        var testNum = $('#Num').val();
        $("#k30Add *[name]").each(function(item){
            data[$(this).attr("name")] = $(this).val();
        });
        data['PointMileage']=parseFloat($('input[name="PointMileage"]').val());
        data['KdjDesign']=parseFloat($('input[name="KdjDesign"]').val());
        data['K3SummaryData'] = [];
        for(var i=0;i<=parseInt(testNum);i++){
            var s1 = $('input[name="S1'+i+'"]').val();
            var S2 = $('input[name="S2'+i+'"]').val();
            var OilPress= $('input[name="OilPress'+i+'"]').val();

            var item = {};
            item.Grade = parseInt($('input[name="Grade'+i+'"]').val());
            item.RealPress = parseFloat($('input[name="Press'+i+'"]').val());
            item.Press = parseFloat($('input[name="Press'+i+'"]').val());
            item.OilPress = parseFloat(OilPress);
            item.S1 = parseFloat(s1)/100;
            item.S2 =parseFloat(S2)/100;
            //平均值显示
            $('input[name="SAv'+i+'"]').val(parseFloat((parseFloat(s1)+parseFloat(S2))/2).toFixed(2));
            //平均值
            var Sav =parseFloat($('input[name="SAv'+i+'"]').val());
            //复位平均值
            var Sav0 = parseFloat($('input[name="SAv0"]').val());

            //荷载板下沉量
            item.SAverage =parseFloat((Sav-Sav0)/100);
            //显示
            $('input[name="SAverage'+i+'"]').val(parseFloat(Sav-Sav0).toFixed(2));
            data['K3SummaryData'].push(item);
        }
        return data;
    }

    function validform(){
        return  $("#k30Add").validate({
            debug:true,
            rules:{
                MachineId:{
                    required:true
                },
                TestWay:{
                    required:true
                },
                PointMileageFlag:{
                    required:true
                },
                PointMileage:{
                    required:true
                },
                Direction:{
                    required:true
                },
                Layers:{
                    required:true
                },
                TotalLayers:{
                    required:true
                },
                Position:{
                    required:true
                },
                TestHeight:{
                    required:true
                },
                FillingThickness:{
                    required:true
                },
                FillingDiameter:{
                    required:true
                },
                FillingStyle:{
                    required:true
                },
                TestType:{
                    required:true
                },
                StartTime:{
                    required:true
                },
                KdjDesign:{
                    required:true
                },
                KdjReal:{
                    required:true
                },
                Result:{
                    required:true
                },

                Humidity:{
                    required:true
                },
                Temperature:{
                    required:true
                }
            }
        });
    }

    function save_submit(){
        //表单验证
            if (validform().form()) {
                var data = getData();
                var data4 = $RS.calcData(data);
                data['KdjReal'] = parseFloat(data4.k);
                $('input[name="KdjReal"]').val(data4.k);
                if(data['KdjReal']>=data['KdjDesign']){
                    data['Result']=1;
                    $('#Result').val(1);
                }else{
                    data['Result']=2;
                    $('#Result').val(2);
                }
                $.ajax({
                    url: "/api/v1/KSData/" + projectId + "/" + id,    //请求的url地址
                    dataType: "json",
                    async: true,
                    data: data,
                    type: "PUT",
                    success: function (reg) {
                        submited = false;
                        if (reg.code == 0) {
                            layer.msg(reg.message, {icon: 1, time: 2000},function(){
                                debugger;
                                   parent.location.href="testk30-details.html";
                            });

                        } else {
                            layer.msg(reg.message, {icon: 5, time: 2000});
                        }
                    },
                    error:function(){
                        layer.msg('保存编辑信息出错！', {icon: 5, time: 5000});
                    }
                });
            }
    }


</script>
</body>
</html>