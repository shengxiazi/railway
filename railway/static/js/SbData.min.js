/**
 * 武汉岩海工程技术有限公司版权所有，未经许可不得使用 
 * 声测数据分析 v1.0 beta
 * Created by xiejianwei on 2017/5/25.
 */(function(r,p){function u(a){var b=a.getContext("2d");a.ctx=b;b.a=b.arc;b.bc=b.bezierCurveTo;b.bp=b.beginPath;b.cp=b.closePath;b.cr=b.clearRect;b.crg=b.createRadialGradient;b.f=b.fill;b.ft=b.fillText;b.fr=b.fillRect;b.l=b.lineTo;b.m=b.moveTo;b.r=b.rect;b.re=b.restore;b.s=b.stroke;b.sa=b.save;b.sc=b.scale;b.t=b.translate;b.ddl=function(a,b,c,m,f){var d=this.setLineDash!==p&&f!==p;d&&this.setLineDash(f);this.bp();this.m(a,b);this.l(c,m);this.s();d&&this.setLineDash([])};b.dcH=function(a,b,c,m,f,k,h){var d=this.setLineDash!==p&&h!==p;d&&this.setLineDash(h);this.strokeStyle=k;this.bp();this.m(1.5,a-b[1]*f);for(k=2;k<c-1;k++)this.l(k*m+.5,a-b[k]*f);this.s();d&&this.setLineDash([])};b.dcs=function(a,b,c,f,n,k){a=Math.round(a);b=Math.round(b);var d=this.setLineDash!==p&&k!==p;d&&this.setLineDash(k);this.strokeStyle=n;this.bp();this.m(a,b);this.l(a+Math.round(56*c),b);this.s();d&&this.setLineDash([]);this.fillStyle=n;this.ft(f,a+64*c,b)}}function v(a){var b,e;e=document.documentElement;var d=document.body;b=(e&&e.scrollLeft||d&&d.scrollLeft||0)-(e&&e.clientLeft||d&&d.clientLeft||0);e=(e&&e.scrollTop||d&&d.scrollTop||0)-(e&&e.clientTop||d&&d.clientTop||0);a=a||r.event;b+=a.clientX;e+=a.clientY;return{x:b,y:e}}function w(a){for(var b=0,e=0,d=a;null!=d;)b+=d.offsetLeft,e+=d.offsetTop,d=d.offsetParent;for(d=a.parentNode;null!=d;d=d.parentNode)1==d.nodeType&&(b-=d.scrollLeft,e-=d.scrollTop);a=r;null!=a.pageXOffset?a={x:a.pageXOffset,y:a.pageYOffset}:(a=a.document,a="CSS1Compat"==document.compatMode?{x:a.documentElement.scrollLeft,y:a.documentElement.scrollTop}:{x:a.body.scrollLeft,y:a.body.scrollTop});b+=a.x;e+=a.y;return{x:b,y:e}}function A(a,b,e,d,c){e=e||0;b=b||f.WAVES;var m=null,n=document.getElementById(a),k={},h=document.createElement("div");h.id=a+"_rsIntegrityDiv";h.style.position="absolute";h.style.left="0px";h.style.top=f.CURVEHEIGHT+"px";h.style.width=n.clientWidth+"px";h.style.height=n.clientHeight-f.CURVEHEIGHT+"px";h.style.border="0px solid";h.style.backgroundColor="#FFFFFF";h.style.overflow="auto";h.left=0;h.top=f.CURVEHEIGHT;h.width=n.clientWidth;h.height=n.clientHeight-f.CURVEHEIGHT;n.appendChild(h);k.integrityCanvasDiv=h;m=document.createElement("canvas");m.id=a+"_rsIntegrity";m.style.position="absolute";m.style.left="0px";m.style.top="0px";m.style.width="100%";m.style.height=c+"px";m.style.border="0px solid";m.style.backgroundColor="#FFFFFF";m.left=0;m.top=0;m.width=h.clientWidth;m.height=c;m.curveType=b;m.setAttribute("width",h.clientWidth);m.setAttribute("height",c);m.cY=-1;u(m);h.appendChild(m);k.integrityCanvas=m;var h=f.CURVEHEIGHT/5,m=["+","-","\x3d\x3d","\x3d","T/A"],g=["\u653e\u5927","\u7f29\u5c0f","\u95e8\u9650\u5927","\u95e8\u9650\u5c0f","\u8bfb\u53d6\u58f0\u65f6\u6ce2\u5e45"];b=Array(5);for(c=0;5>c;c++){var l=document.createElement("input");l.type="button";l.value=m[c];l.title=g[c];l.style.position="absolute";l.style.left="0px";l.style.top=c*h+"px";l.style.width=f.SCALEWIDTH+"px";l.style.height=h+"px";l.style.border="0px solid";l.style.backgroundColor="";l.style.font=f.SCALEWIDTH/5*2+"px Calibri";n.appendChild(l);b[c]=l}m=Array(e);g=Array(e);l=Array(e);k.nodeCanvas=Array(e);var q=(k.integrityCanvas.clientWidth-f.SCALEWIDTH-2*e)/e;for(c=0;c<e;c++)h=document.createElement("div"),h.id=a+"_rsSbSingleNodeDiv"+c,h.style.position="absolute",h.style.left=f.SCALEWIDTH+c*q+2*c+"px",h.style.top="0px",h.style.width=q+"px",h.style.height=f.CURVEHEIGHT+"px",h.style.border="1px solid",h.style.backgroundColor="#FFFFFF",h.style.overflow="auto",h.left=f.SCALEWIDTH+c*q,h.top=0,h.width=q,h.height=f.CURVEHEIGHT,n.appendChild(h),m[c]=h,f.TIMEAXISHEIGHT,g[c]=document.createElement("canvas"),g[c].id=a+"_rsSbSingleNodeTimeAxis"+c,g[c].style.position="absolute",g[c].style.left=0,g[c].style.top="0px",g[c].style.width=(h.clientWidth>d?h.clientWidth:d)+"px",g[c].style.height=f.TIMEAXISHEIGHT+"px",g[c].style.border="0px solid",g[c].style.backgroundColor="#FFFFFF",g[c].left=0,g[c].top=0,g[c].width=h.clientWidth>d?h.clientWidth:d,g[c].height=f.TIMEAXISHEIGHT,u(g[c]),h.appendChild(g[c]),l[c]=document.createElement("canvas"),l[c].id=a+"_rsSbSingleNode"+c,l[c].style.position="absolute",l[c].style.left=0,l[c].style.top=f.TIMEAXISHEIGHT+"px",l[c].style.width=(h.clientWidth>d?h.clientWidth:d)+"px",l[c].style.height=h.clientHeight-f.TIMEAXISHEIGHT+"px",l[c].style.border="0px solid",l[c].style.backgroundColor="#FFFFFF",l[c].left=0,l[c].top=0,l[c].width=h.clientWidth>d?h.clientWidth:d,l[c].height=h.clientHeight-f.TIMEAXISHEIGHT,l[c].integrityCanvas=k.integrityCanvas,u(l[c]),h.appendChild(l[c]);k.nodeCanvas=l;k.axisCanvas=g;k.nodeDivs=m;k.btns=b;k.integrityCanvas._createCacheCanvas=function(a,b,d,c,e){e=e||1;this.cacheCanvas||(this.cacheCanvas=document.createElement("canvas"));this.cacheCanvas.width=d;this.cacheCanvas.height=c;this._cacheWidth=d;this._cacheHeight=c;this._cacheOffsetX=a;this._cacheOffsetY=b;this._cacheScale=e;u(this.cacheCanvas)};k.integrityCanvas._createCacheCanvas(0,0,k.integrityCanvas.width,k.integrityCanvas.height,1);k.integrityCanvas.needRedraw=!0;return k}function f(a){this.BasicInfoId=a.BasicInfoId;this.MachineId=a.MachineId;this.SerialNo=a.SerialNo;this.PileNo=a.PileNo;this.TestTime=a.TestTime;this.PileLength=a.PileLength;this.PileDiameter=a.PileDiameter;this.ConcreteStrength=a.ConcreteStrength;this.TubeCount=a.TubeCount;this.SectionCount=a.SectionCount;this.Step=a.Step;this.Angle=a.Angle;this.GpsIsValid=a.GpsIsValid;this.GpsLongitude=a.GpsLongitude;this.GpsLatitude=a.GpsLatitude;this.ShangGangZheng=a.ShangGangZheng;this.CreateTime=a.CreateTime;this.CreaterName=a.CreaterName;this.ComId=a.ComId;this.BaseInfoId=a.BaseInfoId;this.Sections=null;if(a.SectionData&&"[object Array]"===Object.prototype.toString.call(a.SectionData)){this.Sections=Array(a.SectionData.length);for(var b=0;b<a.SectionData.length;b++)this.Sections[b]=new t(a.SectionData[b])}this.minDepth=0;this.ratioY=.15}function t(a){this.Id=a.Id;this.BasicInfoId=a.BasicInfoId;this.SectionName=a.SectionName;this.TestMode=a.TestMode;this.TubeDistance=a.TubeDistance;this.Step=a.Step;this.ZeroTime=a.ZeroTime;this.SampleInterval=a.SampleInterval;this.SampleLength=a.SampleLength;this.NodesCount=a.NodesCount;this.DataVersion=a.DataVersion;this.Nodes=function(a,e,d,c,f){if(0==e||!a)return null;for(var b=0,m=Array(e),h=0;h<e;h++)m[h]=new g(a,b,d,c,f),b+=24+d*c;return m}(function(a){for(var b=new Uint8Array(256),d=0;64>d;d++)b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(d)]=d;var d=.75*a.length,c=a.length,f=0,g,k,h,x;"\x3d"===a[a.length-1]&&(d--,"\x3d"===a[a.length-2]&&d--);for(var l=new ArrayBuffer(d),q=new Uint8Array(l),d=0;d<c;d+=4)g=b[a.charCodeAt(d)],k=b[a.charCodeAt(d+1)],h=b[a.charCodeAt(d+2)],x=b[a.charCodeAt(d+3)],q[f++]=g<<2|k>>4,q[f++]=(k&15)<<4|h>>2,q[f++]=(h&3)<<6|x&63;return l}(a.SectionData),this.NodesCount,this.SampleLength,1,this.TubeDistance)}function g(a,b,e,d,c){b=new DataView(a,b);this.Depth=b.getInt32(0,!0);this.Delay=b.getFloat32(4,!0);this.Gain=b.getFloat32(8,!0);this.FirstPeakTime=b.getFloat32(12,!0);this.FirstPeakValue=b.getFloat32(16,!0);this.Frequency=b.getFloat32(20,!0);this.Data=new Int8Array(new Int8Array(a,24,e*d));this.Trl=c}if(r.$RSSB===p){f.MIRROR=0;f.WAVES=1;f.VAPSD=2;f.GRID=3;f.CURVEHEIGHT=250;f.TIMEAXISHEIGHT=30;f.TITLEHEIGHT=25;f.SCALEWIDTH=50;f.WAVESPACE=20;f.WAVEOFFSETY=20;f.prototype._initDrawParameters=function(){};f.prototype.scBaseDataJson=function(){var a;a="{"+('"BasicInfoId":'+this.BasicInfoId+",");a+='"MachineId":"'+this.MachineId+'",';a+='"SerialNo":"'+this.SerialNo+'",';a+='"PileNo":"'+this.PileNo+'",';a+='"TestTime":"'+this.TestTime+'",';a+='"PileLength":'+this.PileLength+",";a+='"PileDiameter":"'+this.PileDiameter+'",';a+='"ConcreteStrength":"'+this.ConcreteStrength+'",';a+='"TubeCount":'+this.TubeCount+",";a+='"SectionCount":'+this.SectionCount+",";a+='"Step":'+this.Step+",";a+='"Angle":'+this.Angle+",";a+='"GpsIsValid":'+this.GpsIsValid+",";a+='"GpsLongitude":'+this.GpsLongitude+",";a+='"GpsLatitude":'+this.GpsLatitude+",";a+='"ShangGangZheng":"'+this.ShangGangZheng+'",';a+='"CreateTime":"'+this.CreateTime+'",';a+='"CreaterName":"'+this.CreaterName+'",';a+='"ComId":"'+this.ComId+'",';a+='"BaseInfoId":"'+this.BaseInfoId+'"';return a+"}"};f.prototype.scJson=function(){this.SectionCount=this.Sections.length;var a;a="{"+('"BasicInfoId":'+this.BasicInfoId+",");a+='"MachineId":"'+this.MachineId+'",';a+='"SerialNo":"'+this.SerialNo+'",';a+='"PileNo":"'+this.PileNo+'",';a+='"TestTime":"'+this.TestTime+'",';a+='"PileLength":'+this.PileLength+",";a+='"PileDiameter":"'+this.PileDiameter+'",';a+='"ConcreteStrength":"'+this.ConcreteStrength+'",';a+='"TubeCount":'+this.TubeCount+",";a+='"SectionCount":'+this.SectionCount+",";a+='"Step":'+this.Step+",";a+='"Angle":'+this.Angle+",";a+='"GpsIsValid":'+this.GpsIsValid+",";a+='"GpsLongitude":'+this.GpsLongitude+",";a+='"GpsLatitude":'+this.GpsLatitude+",";a+='"ShangGangZheng":"'+this.ShangGangZheng+'",';a+='"CreateTime":"'+this.CreateTime+'",';a+='"CreaterName":"'+this.CreaterName+'",';a+='"ComId":"'+this.ComId+'",';a+='"BaseInfoId":"'+this.BaseInfoId+'",';a+='"SectionData":[';for(var b=0;b<this.SectionCount;b++)a+=this.Sections[b].scSectionDataJson(),b<this.SectionCount-1&&(a+=",");return a+"]}"};f.parseToSbData=function(a){return"string"===typeof a&&(a=JSON.parse(a),a!==p)?new f(a):null};f.prototype._minMaxDepth=function(){var a=this.Sections.length;if(0==a)return null;var b,e={};e.minDepth=Number.MAX_VALUE;e.maxDepth=Number.MIN_VALUE;for(var d=0;d<a;d++)b=this.Sections[d],b=b.minMaxDepth(),b.minDepth<e.minDepth&&(e.minDepth=b.minDepth),b.maxDepth>e.maxDepth&&(e.maxDepth=b.maxDepth);1>e.minDepth&&(e.minDepth=0);return e};f.prototype._wavesContentHeight=function(){var a=this._minMaxDepth();return((a.maxDepth-a.minDepth)/(this.Step/1E3)+2)*f.WAVESPACE+f.TITLEHEIGHT};t.prototype.scSectionDataJson=function(){var a;a="{"+('"Id":'+this.Id+",");a+='"BasicInfoId":'+this.BasicInfoId+",";a+='"SectionName":"'+this.SectionName+'",';a+='"TestMode":'+this.TestMode+",";a+='"TubeDistance":'+this.TubeDistance+",";a+='"Step":'+this.Step+",";a+='"ZeroTime":'+this.ZeroTime+",";a+='"SampleInterval":'+this.SampleInterval+",";a+='"SampleLength":'+this.SampleLength+",";a+='"NodesCount":'+this.NodesCount+",";a+='"DataVersion":'+this.DataVersion+",";var b=this.sectionToArrayBuffer(this.SampleLength,1),b=new Uint8Array(b),e,d=b.length,c="";for(e=0;e<d;e+=3)c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b[e]>>2],c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(b[e]&3)<<4|b[e+1]>>4],c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(b[e+1]&15)<<2|b[e+2]>>6],c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b[e+2]&63];2===d%3?c=c.substring(0,c.length-1)+"\x3d":1===d%3&&(c=c.substring(0,c.length-2)+"\x3d\x3d");return a+('"SectionData":"'+c+'"')+"}"};t.prototype.sectionToArrayBuffer=function(a,b){var e=24+this.SampleLength*b;this.NodesCount=this.Nodes.length;var d=new ArrayBuffer(e*this.NodesCount),c=new DataView(d),f,g,k;for(g=0;g<this.NodesCount;g++){var h=this.Nodes[g];f=g*e;c.setInt32(f,h.Depth,!0);c.setFloat32(f+4,h.Delay,!0);c.setFloat32(f+8,h.Gain,!0);c.setFloat32(f+12,h.FirstPeakTime,!0);c.setFloat32(f+16,h.FirstPeakValue,!0);c.setFloat32(f+20,h.Frequency,!0);for(k=0;k<a;k++)c.setUint8(f+24+k*b,h.Data[k])}return d};t.prototype.name=function(){var a=this.SectionName.substr(0,1)+"-"+this.SectionName.substr(1,1);1==this.TestMode?a+="(X)":2==this.TestMode&&(a+="(S)");return a};t.prototype.minMaxDepth=function(){var a=this.Nodes.length;if(0==a)return null;var b={};b.minDepth=this.Nodes[a-1].Depth/1E3;b.maxDepth=this.Nodes[0].Depth/1E3;return b};g.READTA=0;g.READT=1;g.READA=2;g.OffsetLine=10;g.ShowScale=1;g.ReadMode=0;g.prototype._getSpeed=function(){return this.Trl/this.FirstPeakTime};g.prototype._getdB=function(){var a=this.FirstPeakValue;return a=0<a?20*Math.log(1E3*a)/Math.log(10):1.11222E-4+a/1E6};g.prototype._lxTodB=function(a){if(a>=this.Data.length||0>a)return 0;a=this.Data[a]/127.5*5E3/this.Gain;0>a&&(a=-a);return a=0<a?20*Math.log(1E3*a)/Math.log(10):1.11222E-4+a/1E6};g.prototype._lxToBoFu=function(a){return a>=this.Data.length||0>a?0:this.Data[a]/127.5*5E3/this.Gain};g.prototype._lxToTime=function(a){return a*this.sampleInterval+this.Delay-this.zeroTime};g.prototype._calculateWaveScope=function(a){if(a>=this.Data.length-20/this.sampleInterval)return 0;var b=this._getMinWavePos(a);a=this._getMaxWavePos(a);return a>b?this._lxToBoFu(b):this._lxToBoFu(a)};g.prototype._getMinWavePos=function(a){for(var b=this.Data,e=-1,d=b.length-3,c=a+3;c<=d;c++)if(b[c]<=b[c-1]&&b[c]<b[c+1]&&b[c]<b[c+2]){e=c;break}if(-1==e)for(c=a+3;c<=d;c++)if(b[c]<=b[c-1]&&b[c]<b[c+1]&&b[c]<b[c+2]){e=c;break}return e};g.prototype._getMaxWavePos=function(a){for(var b=this.Data,e=-1,d=b.length-3,c=a+3;c<=d;c++)if(b[c]>=b[c-1]&&b[c]>b[c+1]&&b[c]>b[c+2]){e=c;break}if(-1==e)for(c=a+3;c<=d;c++)if(b[c]>=b[c-1]&&b[c]>b[c+1]&&b[c]>b[c+2]){e=c;break}return e};f.prototype.drawWaves=function(a){var b=A(a,f.WAVES,this.Sections.length,this.Sections[0].SampleLength,this._wavesContentHeight());this.integrityCanvasDiv=b.integrityCanvasDiv;this.integrityCanvas=b.integrityCanvas;this.integrityCanvas.sbData=this;this.nodeDivs=b.nodeDivs;this.axisCanvas=b.axisCanvas;this.nodeCanvas=b.nodeCanvas;this.btns=b.btns;b=this._minMaxDepth();this.minDepth=b.minDepth;this.maxDepth=b.maxDepth;this.ratioY=f.WAVESPACE/this.Step;this._redrawWaves();this.integrityCanvas.hotArea=Array(1);this.integrityCanvas.hotArea[0]=[f.SCALEWIDTH+1,f.TITLEHEIGHT+1,this.integrityCanvas.width-1,this.integrityCanvas.height-1];this.integrityCanvas.sbData=this;if(this.nodeCanvas)for(b=0;b<this.nodeCanvas.length;b++)this.nodeCanvas[b].onmousemove=function(a){if(this.nodeData){var b=w(this);a=v(a);a.x-=b.x;a.y-=b.y;this.nodeData.onmousemove(this,a)}},this.nodeCanvas[b].onmouseout=function(){if(this.nodeData)this.nodeData.onmouseout(this)},this.nodeCanvas[b].onmousedown=function(a){if(this.nodeData){var b=w(this);a=v(a);a.x-=b.x;a.y-=b.y;this.nodeData.onmousedown(this,a.x);this.integrityCanvas.needRedraw=!0;this.integrityCanvas.sbData._redraw()}};this.integrityCanvas.onmousemove=function(a){var b=w(this);a=v(a);a.x-=b.x;a.y-=b.y;this.sbData.onmousemove(this,a)};this.integrityCanvas.onmouseout=function(){this.sbData.onmouseout(this)};this.integrityCanvas.onmousedown=function(a){var b=this.sbData,d=w(this);a=v(a);a.x-=d.x;a.y-=d.y;y=a.y-(f.TITLEHEIGHT+f.WAVEOFFSETY);this.sbData.onselectnode(y/b.ratioY/1E3)};var e=document.getElementById(a);r.sbData=this;r.onresize=function(){this.sbData.onresize(e.clientWidth,e.clientHeight)};if(this.btns){for(b=0;b<this.btns.length;b++)this.btns[b].sbData=this,this.btns[b].onmouseenter=function(){this.style.font=f.SCALEWIDTH/5*3+"px Calibri";this.style.backgroundColor="#FFD700"},this.btns[b].onmouseleave=function(){this.style.font=f.SCALEWIDTH/5*2+"px Calibri";this.style.backgroundColor=this.isChecked?"#C0C0C0":""};this.btns[0].onmousedown=function(a){g.ShowScale*=1.25;this.sbData._redrawNodes()};this.btns[1].onmousedown=function(a){g.ShowScale*=.8;this.sbData._redrawNodes()};this.btns[2].onmousedown=function(a){50<g.OffsetLine||(g.OffsetLine+=1,this.sbData._redrawNodes())};this.btns[3].onmousedown=function(a){5>g.OffsetLine||(--g.OffsetLine,this.sbData._redrawNodes())};this.btns[4].onmousedown=function(a){g.ReadMode=(g.ReadMode+1)%3;switch(g.ReadMode){case g.READTA:this.value="T/A";this.title="\u8bfb\u53d6\u58f0\u65f6\u6ce2\u5e45";break;case g.READT:this.value="T";this.title="\u8bfb\u53d6\u58f0\u65f6";break;case g.READA:this.value="A",this.title="\u8bfb\u53d6\u6ce2\u5e45"}}}};f.prototype.onmousemove=function(a,b){var e;a:{e=b.x;for(var d=b.y,c=a.hotArea,f=0;f<c.length;f++)if(e>=c[f][0]&&e<=c[f][2]&&d>=c[f][1]&&d<=c[f][3]){e=f;break a}e=-1}a.title=0==e?"\u6b66\u6c49\u5ca9\u6d77\u516c\u53f8\u7248\u6743\u6240\u6709":"";if(0<=e)a.cY=b.y,this._redraw();else this.onmouseout(a)};f.prototype.onmouseout=function(a){0<a.cY&&(a.cY=-1,this._redraw(a))};f.prototype.onresize=function(a,b){var e=this.integrityCanvasDiv;e.style.position="absolute";e.style.left="0px";e.style.top=f.CURVEHEIGHT+"px";e.style.width=a+"px";e.style.height=b-f.CURVEHEIGHT+"px";e.style.border="0px solid";e.style.backgroundColor="#FFFFFF";e.style.overflow="auto";e.left=0;e.top=f.CURVEHEIGHT;e.width=a;e.height=b-f.CURVEHEIGHT;var d=this.integrityCanvas;d.style.position="absolute";d.style.left="0px";d.style.top="0px";d.style.width="100%";d.style.border="0px solid";d.style.backgroundColor="#FFFFFF";d.left=0;d.top=0;d.width=e.clientWidth;d.setAttribute("width",e.clientWidth);e=this.integrityCanvas.cacheCanvas;e.width=d.width;e.height=d.height;this.integrityCanvas.needRedraw=!0;for(var d=this.Sections.length,c=this.Sections[0].SampleLength,g=(this.integrityCanvasDiv.clientWidth-f.SCALEWIDTH-4*d)/d,n=0;n<d;n++){e=this.nodeDivs[n];e.style.left=f.SCALEWIDTH+n*g+4*n+"px";e.style.top="0px";e.style.width=g+"px";e.style.height=f.CURVEHEIGHT+"px";e.style.border="2px solid";e.left=f.SCALEWIDTH+n*g;e.top=0;e.width=g;e.height=f.CURVEHEIGHT;var k=this.axisCanvas[n];k.style.position="absolute";k.style.left="0px";k.style.top="0px";k.style.width=(e.clientWidth>c?e.clientWidth:c)+"px";k.style.height=f.TIMEAXISHEIGHT;k.width=e.clientWidth>c?e.clientWidth:c;k.height=f.TIMEAXISHEIGHT;k=this.nodeCanvas[n];k.style.width=(e.clientWidth>c?e.clientWidth:c)+"px";k.style.height=e.clientHeight-f.TIMEAXISHEIGHT+"px";k.width=e.clientWidth>c?e.clientWidth:c;k.height=e.clientHeight-f.TIMEAXISHEIGHT}this.integrityCanvas.sbData._redraw();this._redrawNodes()};f.prototype.onselectnode=function(a){if(0!=this.Sections.length){var b=this.Sections[0];if(b){var e=Math.round(1E3*(this.PileLength-a)/this.Step);0>e?e=0:e>b.Nodes.length-1&&(e=b.Nodes.length-1)}a=this.Sections.length;for(var d=Array(a),c=0;c<a;c++){b=this.Sections[c];e<b.Nodes.length?(d[c]=b.Nodes[e],d[c].zeroTime=b.ZeroTime,d[c].sampleInterval=b.SampleInterval):d[c]=null;b=this.axisCanvas[c];b.time0=d[c].Delay-d[c].zeroTime;b.sampleInterval=d[c].sampleInterval;var f=this.nodeCanvas[c];f.nodeData=d[c];d[c]._drawFull(f.ctx,f.clientWidth,f.clientHeight);d[c]._drawTimeAxis(b.ctx,b.clientWidth,b.clientHeight,d[c].Delay-d[c].zeroTime,d[c].sampleInterval)}}};f.prototype._redraw=function(){switch(this.integrityCanvas.curveType){case f.MIRROR:this._redrawMirror();break;case f.WAVES:this._redrawWaves();break;case f.VAPSD:this._redrawVAPSD();break;case f.GRID:this._redrawGrid()}};f.prototype._redrawMirror=function(a,b){};f.prototype._redrawGrid=function(a,b){};f.prototype._redrawVAPSD=function(a,b){};f.prototype._redrawWaves=function(){var a=this.integrityCanvas.cacheCanvas;if(a){var b=this.integrityCanvas,e=b.width,d=b.ctx,c=b.ctx,g=b.height;c.sa();c.fillStyle="#0000FFF";c.cr(0,0,e,g);c.re();d.strokeStyle="#000";d.lineWidth=2;d.beginPath();d.m(0,0);d.l(30,30);b.needRedraw&&(this._redrawWaves_Integrity(a),b.needRedraw=!1);d.drawImage(a,0,0,a.width,a.height);a=f.SCALEWIDTH;c=f.TITLEHEIGHT+f.WAVEOFFSETY;e=e-f.SCALEWIDTH-2;d.sa();d.t(a,c);y=b.cY-c;y>=-f.WAVEOFFSETY/2&&(d.lineWidth=1,d.strokeStyle="#F00",d.ddl(.5,y+.5,e-.5,y+.5,[2,2]),b=y/this.ratioY/1E3,b<this.minDepth?b=this.minDepth:b>this.maxDepth&&(b=this.maxDepth),b="h\x3d"+b.toFixed(2)+"m",d.globalAlpha=.8,d.fillStyle="#FFF",30<y?d.fr(1,y-20,e-2,20):d.fr(1,y+1,e-2,20),d.globalAlpha=1,d.font="19px Calibri",d.textAlign="left",d.textBaseline=30<y?"bottom":"top",d.fillStyle="#F00",d.ft(b,4,y));d.re()}};f.prototype._redrawWaves_Integrity=function(a){var b=a.width,e=a.height,d=a.ctx;d.sa();a=a.ctx;a.sa();a.fillStyle="#0000FFF";a.cr(0,0,b,e);a.re();a=this.Sections.length;for(var c=Array(a),g=0;g<a;g++){var n=this.Sections[g];c[g]="\u5256\u9762:"+n.name()+"    \u6d4b\u8ddd:"+n.TubeDistance+"mm"}this._drawFrame(d,b,e,f.SCALEWIDTH,f.TITLEHEIGHT,c,this.minDepth,this.ratioY,f.WAVEOFFSETY);d.t(f.SCALEWIDTH,f.TITLEHEIGHT+f.WAVEOFFSETY);b=(b-f.SCALEWIDTH)/a;for(g=0;g<a;g++)n=this.Sections[g],n._redrawWaves(d,b,e,b*g,0,this.minDepth,this.ratioY);d.re()};f.prototype._redrawNodes=function(){if(this.nodeCanvas)for(var a=0;a<this.nodeCanvas.length;a++){var b=this.nodeCanvas[a],e=this.axisCanvas[a];if(b){var d=b.nodeData;d&&(d._drawFull(b.ctx,b.width,b.height),d._drawTimeAxis(e.ctx,e.clientWidth,e.clientHeight,d.Delay-d.zeroTime,d.sampleInterval))}}};f.prototype._drawFrame=function(a,b,e,d,c,f,g,k,h){var m=f.length,l=(b-d)/m;a.save();a.lineWidth=1;a.strokeStyle="#000000";a.bp();a.moveTo(0,0);a.lineTo(b,0);a.moveTo(0,c);a.lineTo(b,c);for(b=0;b<m;b++)0==b?(a.moveTo(d+b*l,0),a.lineTo(d+b*l,e)):(a.moveTo(d+b*l-1,0),a.lineTo(d+b*l-1,e),a.moveTo(d+b*l+1,0),a.lineTo(d+b*l+1,e));a.stroke();a.fillStyle="#000000";a.textBaseline="middle";a.font=c-8+"px Calibri";a.textAlign="center";for(b=0;b<m;b++)a.ft(f[b],d+b*l+l/2,c/2,l);a.textAlign="center";a.ft("h(m)",d/2,c/2,d);f=5*this.Step;k*=f;m=Math.floor((e-c-h+k-1)/k);a.t(d,c+h);a.bp();a.textAlign="right";for(b=0;b<m;b++)c=g+b*f/1E3,e=b*k,a.m(0,e),a.l(-5,e),a.ft(c.toFixed(2),-6,e,d-6);a.stroke();a.re()};t.prototype._redrawWaves=function(a,b,e,d,c,f,g){e=this.Nodes.length;for(var k,h,m=this.SampleLength<b?1:1+Math.floor((this.SampleLength-1)/b),l=this.ZeroTime,n=this.SampleInterval,p=0;p<e;p++)if(k=this.Nodes[p])h=c+g*(k.Depth-f),k._draw(a,d,h,b,m,g,l,n,8,"#000")};g.prototype._draw=function(a,b,e,d,c,f,g,k,h,p){if(this.Data){a.sa();a.t(b,e);a.lineWidth=1;a.strokeStyle=p;a.bp();b=this.Data;a.m(0,-b[0]*f);d>b.length/c&&(d=b.length/c);for(e=1;e<d;e++)a.l(e,-b[e*c]*f);a.s();a.strokeStyle="#008800";a.bp();d=(this.FirstPeakTime+g-this.Delay)/k/c;a.m(d,-h);a.l(d,h);a.s();a.re()}};g.prototype._drawFull=function(a,b,e,d){a.fillStyle="#F0F0FA";a.fr(0,0,b,e);a.strokeStyle="#00F";a.bp();a.m(0,e/2);a.l(b,e/2);a.s();a.strokeStyle="#F0F";a.ddl(0,e/2-g.OffsetLine,b,e/2-g.OffsetLine,[2,2]);a.ddl(0,e/2+g.OffsetLine,b,e/2+g.OffsetLine,[2,2]);this._draw(a,0,e/2,this.Data.length,1,g.ShowScale,this.zeroTime,this.sampleInterval,e/2,"#00F");a.fillStyle="#000";a.textBaseline="top";a.font="13px Calibri";a.textAlign="left";b="V:"+this._getSpeed().toFixed(3)+"km/s";a.ft(b,0,0);b="A:"+this._getdB().toFixed(1)+"dB";a.ft(b,0,15);b="T:"+this.FirstPeakTime.toFixed(1)+"us";a.ft(b,0,30);a.textBaseline="bottom";b="Amp:"+this.Gain;a.ft(b,0,e);if(d&&0<=d){b="T\x3d"+this._lxToTime(d).toFixed(1)+"us";var c="A\x3d"+this._lxTodB(d).toFixed(1)+"dB";a.lineWidth=1;a.strokeStyle="#F00";a.ddl(d,0,d,e,[2,2]);a.font="13px Calibri";a.textAlign="left";a.textBaseline="top";a.fillStyle="#F00";a.ft(b,d,0);a.ft(c,d,15)}};g.prototype._drawTimeAxis=function(a,b,e,d,c){a.sa();var f=Math.floor(b/10);a.fillStyle="#F0F0FA";a.fr(0,0,b,e);a.t(0,e-1);a.strokeStyle="#000";a.fillStyle=a.strokeStyle;a.textBaseline="bottom";a.font="12px Calibri";a.textAlign="left";a.bp();a.m(0,0);a.l(b,0);for(var g=0;g<f;g++)b=10*g,a.m(b,0),0==g%10?(a.l(b,-10),e=Math.round(d+b*c)+"",g==f-1&&(e+="us"),a.ft(e,b,-10)):a.l(b,-5);a.s();a.re()};g.prototype.onmousemove=function(a,b){a.cX=b.x;this._drawFull(a.ctx,a.clientWidth,a.clientHeight,a.cX)};g.prototype.onmouseout=function(a){a.cX=-1;this._drawFull(a.ctx,a.clientWidth,a.clientHeight,a.cX)};g.prototype.onmousedown=function(a,b){a.cX=-1;switch(g.ReadMode){case g.READTA:this.FirstPeakTime=this._lxToTime(b);this.FirstPeakValue=this._lxToBoFu(b);break;case g.READT:this.FirstPeakTime=this._lxToTime(b);break;case g.READA:this.FirstPeakValue=this._lxToBoFu(b)}this._drawFull(a.ctx,a.clientWidth,a.clientHeight,a.cX)};var z={};z.parseToSbData=f.parseToSbData;r.$RSSB=z}})(window);